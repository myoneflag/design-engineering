{
  "name": "h2x-docker",
  "version": "1.0.0",
  "description": "H2X docker",
  "repository": "gitlab:info892/H2X",
  "license": "UNLICENSED",
  "private": true,
  "main": "index.js",
  "dependencies": {
    "npm-run-all": "^4.1.5"
  },
  "devDependencies": {},
  "scripts": {
    "dev:minimal": "export COMPOSE_HTTP_TIMEOUT=240 && export AWS_PROFILE=$npm_config_profile && docker-compose --profile minimal up --detach",    
    "dev": "export COMPOSE_HTTP_TIMEOUT=240 && export AWS_PROFILE=$npm_config_profile && docker-compose --profile dev up --detach",
    "down": "run-s _require_service && docker-compose rm $npm_config_service",
    "logs": "run-s _require_service && docker-compose logs --follow --tail=100 $npm_config_service",
    "start": "run-s _require_service && docker-compose up --no-deps --detach $npm_config_service",
    "stop": "run-s _require_service && docker-compose stop $npm_config_service",
    "build": "run-s _require_service && docker-compose build $npm_config_service",
    "rebuild": "run-s _require_service && docker-compose build --no-cache $npm_config_service",
    "exec": "run-s _require_service && docker-compose exec $npm_config_service bash",
    "restart": "export AWS_PROFILE=$npm_config_profile && run-s stop start",
    "down:all": "docker-compose --profile dev down",
    "stop:all": "docker-compose --profile dev stop",
    "build:all": "run-s _require_target && docker-compose --profile $npm_config_target build",
    "rebuild:all": "run-s _require_target && docker-compose --profile $npm_config_target build --no-cache",
    "clean": "rm -r dist/**",
    "login": "source ../config/build.env && aws ecr get-login-password --region us-west-1 --profile ${profile} | docker login --username AWS --password-stdin ${ECR_REPOSITORY_URL}",
    "tag": "source ../config/build.env && docker tag h2x-prod-web:latest ${WEB_REMOTE_IMAGE_TAG} && docker tag h2x-prod-worker:latest ${WORKER_REMOTE_IMAGE_TAG}",
    "prep": "source ../config/build.env && mkdir -p ${WEB_DIST} && mkdir -p ${WORKER_DIST} && sed \"s#_IMAGE_NAME_#${WEB_REMOTE_IMAGE_TAG}#g\" Dockerrun.aws.template.json > ${WEB_DIST}/Dockerrun.aws.json && sed \"s#_IMAGE_NAME_#${WORKER_REMOTE_IMAGE_TAG}#g\" Dockerrun.aws.template.json > ${WORKER_DIST}/Dockerrun.aws.json",
    "push": "source ../config/build.env && docker push ${WEB_REMOTE_IMAGE_TAG} && docker push ${WORKER_REMOTE_IMAGE_TAG}",
    "publish": "source ../config/build.env && run-s tag prep push",
    "_require_service": "[[ -z $npm_config_service ]] && { echo 'Usage --service=[backend|frontend|worker|db|mq|sqs|sqsd|nginx]' ; exit 1; } || exit 0",
    "_require_target": "[[ -z $npm_config_target ]] && { echo 'Usage --target=[dev|prod]' ; exit 1; } || exit 0"
  }
}
